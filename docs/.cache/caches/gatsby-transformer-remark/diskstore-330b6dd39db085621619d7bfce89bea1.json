{"expireTime":9007200819376323000,"key":"transformer-remark-markdown-html-ast-ff9c83d9e7ed83d809c293537f7959fd-gatsby-remark-autolink-headersgatsby-remark-copy-linked-filesgatsby-remark-prismjsgatsby-remark-check-links-","val":{"type":"root","children":[{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"DEPRECATED: The engine proxy is not maintained, and to integrate with the Warthog platform's metrics, we recommend using Warthog Server's native reporting functionality. To integrate a non-Node server, take a look at our guide "},{"type":"element","tagName":"a","properties":{"href":"/references/setup-analytics/#other-servers"},"children":[{"type":"text","value":"here"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"background"},"children":[{"type":"element","tagName":"a","properties":{"href":"#background","aria-label":"background permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Background"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The Warthog Engine proxy is a small process that can be run in front of your GraphQL server. Its primary functions are:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Sending "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"performance metrics"}]},{"type":"text","value":" data from your server, which extends its responses with "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/goldcaddy77/warthog-tracing"},"children":[{"type":"raw","value":"<code class=\"language-text\">warthog-tracing</code>"}]},{"type":"text","value":" information, to the Engine cloud service."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Proving a "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"full query caching"}]},{"type":"text","value":" layer, which is controlled using the "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/goldcaddy77/warthog-cache-control"},"children":[{"type":"raw","value":"<code class=\"language-text\">cacheControl</code>"}]},{"type":"text","value":" directive and configured to be either in-memory or shared through Memcache."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Automatically "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"persisting queries"}]},{"type":"text","value":" through a caching layer that can map query IDs to full query strings, allowing clients to send just query IDs over the wire."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The proxy has been "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"deprecated since Warthog Server 2"}]},{"type":"text","value":" was released. Warthog Server 2+ has "},{"type":"element","tagName":"a","properties":{"href":"https://www.warthog.dev/docs/warthog-server/features/metrics"},"children":[{"type":"text","value":"metrics reporting"}]},{"type":"text","value":", "},{"type":"element","tagName":"a","properties":{"href":"https://www.warthog.dev/docs/warthog-server/features/data-sources"},"children":[{"type":"text","value":"data source caching"}]},{"type":"text","value":", "},{"type":"element","tagName":"a","properties":{"href":"https://www.warthog.dev/docs/warthog-server/features/apq"},"children":[{"type":"text","value":"persisted queries"}]},{"type":"text","value":", and "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/goldcaddy77/warthog-server/blob/release-2.5.0/docs/source/features/caching.md"},"children":[{"type":"text","value":"full query caching"}]},{"type":"text","value":" (starting at Warthog Server 2.5) as built-in features, and using it allows you to forego running the proxy. The newest features in Warthog Engine are not supported in the Engine proxy and we recommend that all Node users use Warthog Server 2+ instead of running the proxy."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"That said, the proxy is still a good option for getting set up with Engine in a few "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"specific"}]},{"type":"text","value":" circumstances:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"You are not using Warthog Server, your server has an "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/goldcaddy77/warthog-tracing"},"children":[{"type":"raw","value":"<code class=\"language-text\">warthog-tracing</code>"}]},{"type":"text","value":" plugin, and you want to get "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"performance metrics"}]},{"type":"text","value":" insights."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"You are not using Warthog Server and you want to use Warthog's "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"automatic persisted queries"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"setup"},"children":[{"type":"element","tagName":"a","properties":{"href":"#setup","aria-label":"setup permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Setup"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To get started with using Engine through the Engine proxy, you will need to:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#instrument-your-server"},"children":[{"type":"text","value":"Install a package in your GraphQL server that adds "},{"type":"raw","value":"<code class=\"language-text\">extension</code>"},{"type":"text","value":" data (in the Warthog Tracing format) to each request's response."}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#get-your-api-key"},"children":[{"type":"text","value":"Get your Engine API key."}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#run-the-proxy"},"children":[{"type":"text","value":"Configure and deploy the Engine proxy to run in front of your server using either Docker or npm."}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"instrument-your-server"},"children":[{"type":"element","tagName":"a","properties":{"href":"#instrument-your-server","aria-label":"instrument your server permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Instrument your server"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To get the performance metrics value out of Engine, you'll need to install a package in your server that adds the "},{"type":"raw","value":"<code class=\"language-text\">warthog-tracing</code>"},{"type":"text","value":" GraphQL extension. If you want to set up response caching, you'll also need to install a package that adds the "},{"type":"raw","value":"<code class=\"language-text\">warthog-cache-control</code>"},{"type":"text","value":" extension."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Note:"}]},{"type":"text","value":" If you're installing the Engine proxy "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"just"}]},{"type":"text","value":" to set up automatic persisited queries, you can skip ahead to the "},{"type":"element","tagName":"a","properties":{"href":"#get-your-api-key"},"children":[{"type":"text","value":"next section"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The "},{"type":"raw","value":"<code class=\"language-text\">warthog-tracing</code>"},{"type":"text","value":" and "},{"type":"raw","value":"<code class=\"language-text\">warthog-cache-control</code>"},{"type":"text","value":" extensions are open specifications that can be implemented by any GraphQL server, and the following is a list of implementations:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Node"}]},{"type":"text","value":" with "},{"type":"element","tagName":"a","properties":{"href":"https://www.warthog.dev/docs/warthog-server/"},"children":[{"type":"text","value":"Warthog Server"}]},{"type":"text","value":" natively supports tracing and cache control. See "},{"type":"element","tagName":"a","properties":{"href":"#run-the-proxy"},"children":[{"type":"text","value":"Node setup instructions"}]},{"type":"text","value":" for a more streamlined Node setup option."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Ruby"}]},{"type":"text","value":" with "},{"type":"element","tagName":"a","properties":{"href":"http://graphql-ruby.org/"},"children":[{"type":"text","value":"GraphQL-Ruby"}]},{"type":"text","value":" supports tracing with the "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/uniiverse/warthog-tracing-ruby"},"children":[{"type":"text","value":"warthog-tracing-ruby"}]},{"type":"text","value":" gem."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Java"}]},{"type":"text","value":" with "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/graphql-java/graphql-java"},"children":[{"type":"text","value":"GraphQL-Java"}]},{"type":"text","value":" natively supports tracing. "},{"type":"element","tagName":"a","properties":{"href":"https://www.graphql-java.com/documentation/master/instrumentation/"},"children":[{"type":"text","value":"Read the docs about using Warthog tracing."}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Scala"}]},{"type":"text","value":" with "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/sangria-graphql/sangria"},"children":[{"type":"text","value":"Sangria"}]},{"type":"text","value":" supports tracing with "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/sangria-graphql/sangria-slowlog#warthog-tracing-extension"},"children":[{"type":"text","value":"sangria-slowlog"}]},{"type":"text","value":" project."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Elixir"}]},{"type":"text","value":" with "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/absinthe-graphql/absinthe"},"children":[{"type":"text","value":"Absinthe"}]},{"type":"text","value":" supports tracing with the "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/sikanhe/warthog-tracing-elixir"},"children":[{"type":"text","value":"warthog-tracing-elixir"}]},{"type":"text","value":" package."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can test that you’ve correctly enabled Warthog Tracing by running any query against your API using GraphiQL."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The "},{"type":"raw","value":"<code class=\"language-text\">tracing</code>"},{"type":"text","value":" field should now be returned as part of the response's "},{"type":"raw","value":"<code class=\"language-text\">extensions</code>"},{"type":"text","value":" like below. Don’t worry, this data won’t make it back to your clients once you've set up the Engine proxy, because the proxy will filter it out."}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"data\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token string\">\"extensions\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token string\">\"tracing\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"get-your-api-key"},"children":[{"type":"element","tagName":"a","properties":{"href":"#get-your-api-key","aria-label":"get your api key permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Get your API key"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"http://engine.warthog.dev/?_ga=2.233930590.1351805406.1542648368-1704540304.1492481658"},"children":[{"type":"text","value":"Log into Warthog Engine"}]},{"type":"text","value":" and create a graph to get an API key. We’ll be using your new key in the next step."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"run-the-proxy"},"children":[{"type":"element","tagName":"a","properties":{"href":"#run-the-proxy","aria-label":"run the proxy permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Run the proxy"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The proxy is a small process written in Go that you host and run inside your infrastructure. It's designed to allow all of your requests and responses to pass through normally while it collects trace data, caches results, and identifies persisted queries. It's designed to handle large volumes of traffic comfortably without overloading. It does not rely on accessing the Engine cloud service to run or perform caching functions, but if it cannot talk to the Engine cloud service it will not be able to report metrics."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Warthog distributes the Engine proxy in two forms: as an "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"npm package"}]},{"type":"text","value":" and as a "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Docker container"}]},{"type":"text","value":". You can use any one of the following options for running the proxy, depending what works best for you and your team:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#option-1-running-the-proxy-with-warthog-server"},"children":[{"type":"text","value":"Run the proxy with Warthog Server"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#option-2-running-a-standalone-proxy-using-node"},"children":[{"type":"text","value":"Run a standalone proxy using Node"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#option-3-running-a-standalone-proxy-with-docker"},"children":[{"type":"text","value":"Run a standalone proxy using Docker"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#option-4-running-the-proxy-through-a-platform-as-a-service-eg-heroku"},"children":[{"type":"text","value":"Run the proxy through a Platform as a Service (eg. Heroku)"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#option-5-running-the-proxy-in-a-serverless-environment-eg-lambda"},"children":[{"type":"text","value":"Run the proxy in a serverless environment (eg. Lambda)"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"option-1-running-the-proxy-with-warthog-server"},"children":[{"type":"element","tagName":"a","properties":{"href":"#option-1-running-the-proxy-with-warthog-server","aria-label":"option 1 running the proxy with warthog server permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Option 1: Running the proxy with Warthog Server"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The two cases where you should be running the Engine proxy with Warthog Server are:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"You are using Warthog Server 1 and want the Warthog platform features that Engine brings."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"You are using Warthog Server >2 & <2.5+ and want full query caching using the Engine proxy."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Note:"}]},{"type":"text","value":" If you're using Warthog Server but neither of these conditions apply to you, you should be using the built-in features of Warthog Server 2+ instead of the Engine proxy."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This section assumes you're running your GraphQL server with the "},{"type":"raw","value":"<code class=\"language-text\">express</code>"},{"type":"text","value":" web server package for Node, but if you're using a different framework the steps will be similar."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"First, install the "},{"type":"raw","value":"<code class=\"language-text\">warthog-engine</code>"},{"type":"text","value":" package from npm:"}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save warthog-engine</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Then import the "},{"type":"raw","value":"<code class=\"language-text\">ApolloEngine</code>"},{"type":"text","value":" constructor and create a new Engine instance. You'll need to replace "},{"type":"raw","value":"<code class=\"language-text\">app.listen()</code>"},{"type":"text","value":" with "},{"type":"raw","value":"<code class=\"language-text\">engine.listen()</code>"},{"type":"text","value":" like below:"}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// Import ApolloEngine</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> ApolloEngine <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'warthog-engine'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> ApolloServer <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'warthog-server-express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Initialize Warthog Server</span>\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  typeDefs<span class=\"token punctuation\">,</span>\n  resolvers<span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">// Make sure that tracing and cacheControl are both enabled</span>\n  tracing<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  cacheControl<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">// By setting this to \"false\", we avoid using Warthog Server 2's</span>\n  <span class=\"token comment\">// integrated metric reporting and fall-back to using the Warthog</span>\n  <span class=\"token comment\">// Engine Proxy (running separately) for metric collection.</span>\n  engine<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Initialize your Express app like usual</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// All of your GraphQL middleware goes here</span>\nserver<span class=\"token punctuation\">.</span><span class=\"token function\">applyMiddleware</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> app <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Initialize engine with your API key. Alternatively,</span>\n<span class=\"token comment\">// set the ENGINE_API_KEY environment variable when you</span>\n<span class=\"token comment\">// run your program.</span>\n<span class=\"token keyword\">const</span> engine <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloEngine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  apiKey<span class=\"token punctuation\">:</span> <span class=\"token string\">'API_KEY_HERE'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Call engine.listen(...) instead of app.listen(port) as you usually would</span>\nengine<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  port<span class=\"token punctuation\">:</span> <span class=\"token number\">4000</span><span class=\"token punctuation\">,</span>\n  expressApp<span class=\"token punctuation\">:</span> app\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Engine is now wrapping your endpoint and processing your GraphQL requests and responses like normal. If you call your endpoint again, your requests will be routed through the Engine proxy to your server and back. If everything is working, you will no longer see "},{"type":"raw","value":"<code class=\"language-text\">tracing</code>"},{"type":"text","value":" data in your responses because your Engine proxy is filtering and processing that information for you."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"option-2-running-a-standalone-proxy-using-node"},"children":[{"type":"element","tagName":"a","properties":{"href":"#option-2-running-a-standalone-proxy-using-node","aria-label":"option 2 running a standalone proxy using node permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Option 2: Running a standalone proxy using Node"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Even if your GraphQL server is not implemented with Node, you may find it easier to run a tiny Node program in your hosting environment than to run a Docker container. If so, this proxy deployment option is for you."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The "},{"type":"raw","value":"<code class=\"language-text\">warthog-engine</code>"},{"type":"text","value":" npm package contains an "},{"type":"raw","value":"<code class=\"language-text\">ApolloEngineLauncher</code>"},{"type":"text","value":" API, which simply runs the Engine proxy with a given configuration."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"First, install the "},{"type":"raw","value":"<code class=\"language-text\">warthog-engine</code>"},{"type":"text","value":" package from npm:"}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save warthog-engine</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Then write a small Node program that uses it, like so:"}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> ApolloEngineLauncher <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'warthog-engine'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Define the Engine configuration.</span>\n<span class=\"token keyword\">const</span> launcher <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloEngineLauncher</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Note: you can also provide this in the ENGINE_API_KEY environment variable.</span>\n  apiKey<span class=\"token punctuation\">:</span> <span class=\"token string\">'API_KEY_HERE'</span><span class=\"token punctuation\">,</span>\n  origins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      http<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// The URL that the proxy should use to connect to your GraphQL server.</span>\n        url<span class=\"token punctuation\">:</span> <span class=\"token string\">'http://localhost:4000/api/graphql'</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// Tell the proxy which ports to listen to and which paths should</span>\n  <span class=\"token comment\">// be treated as GraphQL instead of transparently proxied as raw HTTP.</span>\n  frontends<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      port<span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// default if left out: process.env.PORT</span>\n      endpoints<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'/api/graphql'</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">// default if left out: /['/graphql]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Start the Proxy; crash on errors.</span>\nlauncher<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Note:"}]},{"type":"text","value":" Every deployment has its unique needs and we provide a variety of configuration options to fulfill them. For more configuration options, please see the "},{"type":"element","tagName":"a","properties":{"href":"/references/proxy-config/"},"children":[{"type":"text","value":"proxy config docs"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Note:"}]},{"type":"text","value":" The argument to "},{"type":"raw","value":"<code class=\"language-text\">new ApolloEngineLauncher()</code>"},{"type":"text","value":" is generally the same as the argument Node GraphQL users pass to "},{"type":"raw","value":"<code class=\"language-text\">new ApolloEngine()</code>"},{"type":"text","value":". The main differences are that you need to specify the origin's HTTP URL yourself with "},{"type":"raw","value":"<code class=\"language-text\">new ApolloEngineLauncher()</code>"},{"type":"text","value":", and the frontend "},{"type":"raw","value":"<code class=\"language-text\">port</code>"},{"type":"text","value":" and "},{"type":"raw","value":"<code class=\"language-text\">endpoints</code>"},{"type":"text","value":" are specified inside the constructor instead of as options to "},{"type":"raw","value":"<code class=\"language-text\">listen()</code>"},{"type":"text","value":"."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you run this program with Node, the proxy will start up and start accepting connections at "},{"type":"element","tagName":"a","properties":{"href":"http://localhost:3000"},"children":[{"type":"text","value":"http://localhost:3000"}]},{"type":"text","value":". It will forward all requests to your server, which you told it is running on "},{"type":"element","tagName":"a","properties":{"href":"http://localhost:4000"},"children":[{"type":"text","value":"http://localhost:4000"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you open up GraphiQL on "},{"type":"element","tagName":"a","properties":{"href":"http://localhost:3000"},"children":[{"type":"text","value":"http://localhost:3000"}]},{"type":"text","value":", you'll notice that the "},{"type":"raw","value":"<code class=\"language-text\">tracing</code>"},{"type":"text","value":" extension data is no longer in the result of your query. This is because Engine is consuming it! You can verify that everything is working correctly by checking the Engine UI for your new service and confirming that you see data in the Metrics section."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"option-3-running-a-standalone-proxy-with-docker"},"children":[{"type":"element","tagName":"a","properties":{"href":"#option-3-running-a-standalone-proxy-with-docker","aria-label":"option 3 running a standalone proxy with docker permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Option 3: Running a standalone proxy with Docker"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The Engine proxy is also distributed as a Docker image that you can deploy and manage separate from your server. It does not matter where you choose to deploy and manage your proxy, though it's more efficient if your proxy is located on the same machine or network as your GraphQL server."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The Docker container distribution of Engine proxy is configured using a JSON "},{"type":"raw","value":"<code class=\"language-text\">engine-config.json</code>"},{"type":"text","value":" configuration file, like so:"}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"apiKey\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"API_KEY_HERE\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"origins\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"http\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">\"url\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"http://localhost:4000/api/graphql\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"frontends\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"port\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"endpoints\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"/api/graphql\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Note:"}]},{"type":"text","value":" Every deployment has its unique needs, and we provide a variety of configuration options to fulfill them. For example, if your origin GraphQL server is running in a virtual-hosted environment (e.g. Heroku, AWS), you may need to override the "},{"type":"raw","value":"<code class=\"language-text\">Host</code>"},{"type":"text","value":" header sent to HTTP origins. For more details and instruction on configuration options, please see the "},{"type":"element","tagName":"a","properties":{"href":"/references/proxy-config/"},"children":[{"type":"text","value":"proxy config docs"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As it is JSON file, all object keys must be quoted, and trailing commas and comments are not allowed. Any reference in our docs to options passed to "},{"type":"raw","value":"<code class=\"language-text\">new ApolloEngine()</code>"},{"type":"text","value":" otherwise translates directly into the engine config file. Like with "},{"type":"raw","value":"<code class=\"language-text\">ApolloEngineLauncher</code>"},{"type":"text","value":", you need to specify your GraphQL server's origin http URL (or other origin type like Lambda) inside the config file, and you need to specify the frontend port and GraphQL paths inside the config file rather than separately (if you're not using the default values of "},{"type":"raw","value":"<code class=\"language-text\">process.env.PORT</code>"},{"type":"text","value":" and "},{"type":"raw","value":"<code class=\"language-text\">[&#39;/graphql&#39;]</code>"},{"type":"text","value":")."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Next, make sure you have a working "},{"type":"element","tagName":"a","properties":{"href":"https://docs.docker.com/engine/installation/"},"children":[{"type":"text","value":"Docker installation"}]},{"type":"text","value":" and type the following lines in your shell:"}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">$ ENGINE_PORT=3000\n$ docker run --env &quot;ENGINE_CONFIG=$(cat engine-config.json)&quot; -p &quot;${ENGINE_PORT}:${ENGINE_PORT}&quot; gcr.io/mdg-public/engine:1.1</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Note:"}]},{"type":"text","value":" We use "},{"type":"element","tagName":"a","properties":{"href":"https://semver.org/"},"children":[{"type":"text","value":"semver"}]},{"type":"text","value":" to name Engine Proxy release versions, and we release version 1.2.3 under the tags "},{"type":"raw","value":"<code class=\"language-text\">1.2.3</code>"},{"type":"text","value":", "},{"type":"raw","value":"<code class=\"language-text\">1.2</code>"},{"type":"text","value":", and "},{"type":"raw","value":"<code class=\"language-text\">1</code>"},{"type":"text","value":". If you want to pin to a precise version, use the "},{"type":"raw","value":"<code class=\"language-text\">1.2.3</code>"},{"type":"text","value":" tag. If you'd like to take patch upgrades but not minor upgrades, use the "},{"type":"raw","value":"<code class=\"language-text\">1.2</code>"},{"type":"text","value":" tag. If you'd like to take minor upgrades, use the "},{"type":"raw","value":"<code class=\"language-text\">1</code>"},{"type":"text","value":" tag."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This will run the Engine Proxy via Docker, routing port 3000 inside the container to port 3000 outside the container. (You can also pass "},{"type":"raw","value":"<code class=\"language-text\">--net=host</code>"},{"type":"text","value":" instead of the "},{"type":"raw","value":"<code class=\"language-text\">-p 3000:3000</code>"},{"type":"text","value":" to just allow the Proxy direct access to your host's network.)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The Proxy should start up and accept connections at "},{"type":"element","tagName":"a","properties":{"href":"http://localhost:3000"},"children":[{"type":"text","value":"http://localhost:3000"}]},{"type":"text","value":" and forward all requests to your server at "},{"type":"element","tagName":"a","properties":{"href":"http://localhost:4000"},"children":[{"type":"text","value":"http://localhost:4000"}]},{"type":"text","value":". Load GraphiQL through Engine at "},{"type":"element","tagName":"a","properties":{"href":"http://localhost:3000/graphiql"},"children":[{"type":"text","value":"http://localhost:3000/graphiql"}]},{"type":"text","value":" (or wherever you have configured your app to serve GraphiQL) and run any query. You should no longer see the "},{"type":"raw","value":"<code class=\"language-text\">tracing</code>"},{"type":"text","value":" data in the result since Engine is now consuming it! Checking the Engine UI for your service, you should see data from the request you sent via GraphiQL come through in the metrics tab."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can find the complete documentation for Engine configuration options on the "},{"type":"element","tagName":"a","properties":{"href":"/references/proxy-config/"},"children":[{"type":"text","value":"full API docs"}]},{"type":"text","value":" page, and some commonly-used fields worth knowing about are described in the "},{"type":"element","tagName":"a","properties":{"href":"/references/proxy-config/#top-level-options"},"children":[{"type":"raw","value":"<code class=\"language-text\">new ApolloEngineLauncher()</code>"},{"type":"text","value":" docs"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"option-4-running-the-proxy-through-a-platform-as-a-service-eg-heroku"},"children":[{"type":"element","tagName":"a","properties":{"href":"#option-4-running-the-proxy-through-a-platform-as-a-service-eg-heroku","aria-label":"option 4 running the proxy through a platform as a service eg heroku permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Option 4: Running the proxy through a Platform as a Service (eg. Heroku)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It may be most convenient for you to run and host the Engine proxy outside your app's deployment altogether. If that is the case, automatically running the proxy on a Platform as a Service like Heroku might be the easiest option for you."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We have an example repository with a guide for "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/goldcaddy77/engine-heroku-example"},"children":[{"type":"text","value":"running the Engine proxy on Heroku"}]},{"type":"text","value":" that you can follow along in. Like running a "},{"type":"element","tagName":"a","properties":{"href":"#option-3-running-a-standalone-proxy-with-docker"},"children":[{"type":"text","value":"standalone proxy with Docker"}]},{"type":"text","value":", you'll need to configure your proxy with an "},{"type":"raw","value":"<code class=\"language-text\">engine-config.json</code>"},{"type":"text","value":" file like so:"}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"apiKey\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;ENGINE_API_KEY>\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"origins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"http\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://yourappname.herokuapp.com/graphql\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"overrideRequestHeaders\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"Host\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"yourappname.herokuapp.com\"</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"frontends\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"host\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.0.0.0\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"port\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"3000\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"graphqlPaths\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"/graphql\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Note:"}]},{"type":"text","value":" For Virtual Hosted environments where the "},{"type":"raw","value":"<code class=\"language-text\">PORT</code>"},{"type":"text","value":" is dynamically set in an environment variable named "},{"type":"raw","value":"<code class=\"language-text\">$PORT</code>"},{"type":"text","value":", you can leave out the "},{"type":"raw","value":"<code class=\"language-text\">port</code>"},{"type":"text","value":" option. If your environment uses a different environment variable, you can name it with the "},{"type":"raw","value":"<code class=\"language-text\">portFromEnv</code>"},{"type":"text","value":" option instead. For more details and instruction on configuration options, please see the "},{"type":"element","tagName":"a","properties":{"href":"/references/proxy-config/"},"children":[{"type":"text","value":"proxy config docs"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It does not matter where you choose to deploy and manage your Engine proxy. We've built this guide for Heroku because they have an easy deployment mechanism for Docker containers, but we run our own Engine proxy on Amazon's "},{"type":"element","tagName":"a","properties":{"href":"https://aws.amazon.com/ecs/"},"children":[{"type":"text","value":"EC2 Container Service"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"option-5-running-the-proxy-in-a-serverless-environment-eg-lambda"},"children":[{"type":"element","tagName":"a","properties":{"href":"#option-5-running-the-proxy-in-a-serverless-environment-eg-lambda","aria-label":"option 5 running the proxy in a serverless environment eg lambda permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Option 5: Running the proxy in a serverless environment (eg. Lambda)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Last but not least, you may be wondering how to use Engine if you run your application in a serverless environment like Lamdba. If so, this is the guide for you!"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Note:"}]},{"type":"text","value":" The best option for using Engine if you're running in a serverless environment is to use Warthog Server 2+ and its built-in reporting mechanism. Running the Engine proxy in serverless environments is tricky because the "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"proxy is stateful"}]},{"type":"text","value":" and needs to be run separately from your cloud function."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To use Engine when running in serverless environments, we will need to configure and deploy the Engine proxy as a standalone docker container that is "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"separate"}]},{"type":"text","value":" from your cloud function. The Engine proxy is stateful (it collects and aggregates your metrics across requests), and as such it should not be deployed with your cloud function, but separately."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The only available option for running the Engine proxy with cloud functions is to run the proxy in a standalone docker container. To do that, you can follow one of our guides here:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#option-2-running-a-standalone-proxy-using-node"},"children":[{"type":"text","value":"Run a standalone proxy using Node"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#option-3-running-a-standalone-proxy-with-docker"},"children":[{"type":"text","value":"Run a standalone proxy using Docker"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#option-4-running-the-proxy-through-a-platform-as-a-service-eg-heroku"},"children":[{"type":"text","value":"Run the proxy through a Platform as a Service (eg. Heroku)"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The proxy needs to be run separately from your function because it's responsible for capturing, aggregating, and sending to Engine the trace data from each Lamdba instance GraphQL response."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The main difference between setting up the proxy to work with cloud functions versus setting it up with a persistent server is in how you configure it. You'll want an "},{"type":"raw","value":"<code class=\"language-text\">engine-config.json</code>"},{"type":"text","value":" that looks something like this:"}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"apiKey\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;ENGINE_API_KEY>\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"origins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"lambda\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"functionArn\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"arn:aws:lambda:xxxxxxxxxxx:xxxxxxxxxxxx:function:xxxxxxxxxxxxxxxxxxx\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"awsAccessKeyId\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"xxxxxxxxxxxxxxxxxxxx\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"awsSecretAccessKey\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"frontends\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"host\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.0.0.0\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"port\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3001</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"endpoints\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"/graphql\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Note:"}]},{"type":"text","value":" This example is for AWS Lambda specifically, for which we have a special "},{"type":"raw","value":"<code class=\"language-text\">origins</code>"},{"type":"text","value":" type. Other cloud functions are supported with the standard HTTP invocation, and for non-AWS cloud functions see "},{"type":"element","tagName":"a","properties":{"href":"#option-3-running-a-standalone-proxy-with-docker"},"children":[{"type":"text","value":"the standalone docs"}]},{"type":"text","value":" for instructions on settup up the Engine proxy as a standalone API gateway to your cloud function. For full configuration details see "},{"type":"element","tagName":"a","properties":{"href":"/references/proxy-config/"},"children":[{"type":"text","value":"proxy config"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The Engine proxy will invoke the Lambda function as if it was called from Amazon's "},{"type":"element","tagName":"a","properties":{"href":"https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-set-up-simple-proxy.html#api-gateway-simple-proxy-for-lambda-input-format"},"children":[{"type":"text","value":"API Gateway"}]},{"type":"text","value":", and the function should return a value suitable for "},{"type":"element","tagName":"a","properties":{"href":"https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-set-up-simple-proxy.html#api-gateway-simple-proxy-for-lambda-output-format"},"children":[{"type":"text","value":"API Gateway"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you've got a proxy running and successfully configured to talk to your cloud functions, then sending a request to it will invoke your function and return the response back to you. If everything is working, you should be able to visit the Metrics tab in the Engine UI and see data from the requests you're sending in the interface!"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"feature-configuration"},"children":[{"type":"element","tagName":"a","properties":{"href":"#feature-configuration","aria-label":"feature configuration permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Feature configuration"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The following proxy features require specific setup steps to get working."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#automatic-persisted-queries-apq"},"children":[{"type":"text","value":"Automatically "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"persisting"}]},{"type":"text","value":" your queries"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#caching"},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Caching"}]},{"type":"text","value":" full query responses"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#cdn-integration"},"children":[{"type":"text","value":"Integrating with your "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"CDN"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#query-batching"},"children":[{"type":"text","value":"Using the Engine proxy with "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"query batching"}]}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"automatic-persisted-queries-apq"},"children":[{"type":"element","tagName":"a","properties":{"href":"#automatic-persisted-queries-apq","aria-label":"automatic persisted queries apq permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Automatic Persisted Queries (APQ)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Automatically persisting your queries is a performance technique in which you send a query hash to your server instead of the entire GraphQL query string. Your server keeps track of the map between these hashes and their full query strings and does the lookup on its end, saving you the bandwidth of sending the full query string over the wire."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"An added benefit of using APQs with GraphQL is that it's an easy mechanism to transform your GraphQL POST requests into GET requests, allowing you to easily leverage any CDN infrastructure you may already have in place."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Note:"}]},{"type":"text","value":" Warthog Server 2 reduces the setup necessary to use automatic persisted queries, and these instructions are only necessary when using the Warthog Engine Proxy. To find out more visit the "},{"type":"element","tagName":"a","properties":{"href":"https://www.warthog.dev/docs/warthog-server/features/apq/"},"children":[{"type":"text","value":"Warthog Server"}]},{"type":"text","value":" docs."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The query registry that maps query hashes to query strings is stored in a user-configurable cache and read by the Engine proxy. This can either be an in-memory store (configured by default to be 50MB) within each Engine proxy instance, or an external, configurable "},{"type":"element","tagName":"a","properties":{"href":"https://memcached.org/"},"children":[{"type":"text","value":"memcached"}]},{"type":"text","value":" store."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To use automatic persisted queries with the Engine proxy:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Use Engine proxy "},{"type":"raw","value":"<code class=\"language-text\">v1.0.1</code>"},{"type":"text","value":" or newer."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"If your GraphQL server is hosted on a different origin domain from where it will be accessed, setup the appropriate "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Cross-origin_resource_sharing"},"children":[{"type":"text","value":"CORS headers"}]},{"type":"text","value":" using the "},{"type":"raw","value":"<code class=\"language-text\">overrideGraphqlResponseHeaders</code>"},{"type":"text","value":" object on the proxy's "},{"type":"raw","value":"<code class=\"language-text\">frontend</code>"},{"type":"text","value":" configuration:"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">frontends<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n  overrideGraphqlResponseHeaders<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'Access-Control-Allow-Origin'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'*'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Configure your client to use APQs. If you're using Warthog Client, you can easily use "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/goldcaddy77/warthog-link-persisted-queries#automatic-persisted-queries"},"children":[{"type":"raw","value":"<code class=\"language-text\">warthog-link-persisted-queries</code>"}]},{"type":"text","value":" to set this up."}]},{"type":"text","value":"\n"},{"type":"raw","value":"<!-- * Verify APQ is working properly using the [verification procedure] (// TODO(dman): get link to new article). -->"},{"type":"text","value":"\n"},{"type":"raw","value":"<!-- * Read [how it works] (// TODO(dman): get link to new article) for additional details. -->"},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If everything is set up correctly, you should see your client sending hashes insteady of query strings over the network, but receiving data as if it had sent a normal query."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"caching"},"children":[{"type":"element","tagName":"a","properties":{"href":"#caching","aria-label":"caching permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Caching"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To bring caching to GraphQL we've developed "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/goldcaddy77/warthog-cache-control"},"children":[{"type":"text","value":"Warthog Cache Control"}]},{"type":"text","value":", an open standard that allows servers to specify exactly which parts of a response can be cached and how long they can be cached for."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We've built a mechanism into the Engine proxy that allows it to read these \"cache hints\" that servers send along with their responses. It uses these hints to determine if the response can be cached, wether or not it should be cached for everyone or a specific user, and how long it can be cached for."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The Engine proxy computes a cache privacy level and expiration date by combining the data from all of the fields returned by the server for a particular request. It errs on the safe side, so shorter "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":" results override longer and "},{"type":"raw","value":"<code class=\"language-text\">PRIVATE</code>"},{"type":"text","value":" scope overrides "},{"type":"raw","value":"<code class=\"language-text\">PUBLIC</code>"},{"type":"text","value":". A missing "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":" on a field will default to "},{"type":"raw","value":"<code class=\"language-text\">0</code>"},{"type":"text","value":", meaning that all fields in the result must have a "},{"type":"raw","value":"<code class=\"language-text\">maxAge &gt; 0</code>"},{"type":"text","value":" for the response to be cached at all."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The Engine proxy reads Warthog Cache Control extensions, caching whole query responses based on the computed cacheability of each new query. The Engine UI will visualize how each query was impacted by the cache policy set on it."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There are just a few steps to enable response caching in Engine proxy, and one of them is optional!"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#1-add-cachecontrol-extensions-to-your-sevrer"},"children":[{"type":"text","value":"Extend your server's responses with "},{"type":"raw","value":"<code class=\"language-text\">cacheControl</code>"},{"type":"text","value":" extensions."}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#2-add-cache-hints-to-your-responses"},"children":[{"type":"text","value":"Annotate your schema and/or resolvers with cache control hints."}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#3-optional-configure-cache-options"},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Optional:"}]},{"type":"text","value":" Configure cache options in your Engine Proxy configuration."}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"1-add-cachecontrol-extensions-to-your-sevrer"},"children":[{"type":"element","tagName":"a","properties":{"href":"#1-add-cachecontrol-extensions-to-your-sevrer","aria-label":"1 add cachecontrol extensions to your sevrer permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"1. Add "},{"type":"raw","value":"<code class=\"language-text\">cacheControl</code>"},{"type":"text","value":" extensions to your sevrer"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you're using Warthog Server for your Node GraphQL server, the only server code change required is to add "},{"type":"raw","value":"<code class=\"language-text\">cacheControl: true</code>"},{"type":"text","value":" to the options passed to your Warthog Server configuration."}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// Warthog Server 2:</span>\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  typeDefs<span class=\"token punctuation\">,</span>\n  resolvers<span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">  cacheControl<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Warthog Server 1.2 and onwards:</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">'/graphql'</span><span class=\"token punctuation\">,</span>\n  bodyParser<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">graphqlExpress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    schema<span class=\"token punctuation\">,</span>\n    context<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">    cacheControl<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span></span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We're working with the community to add support for Warthog Cache Control to non-Node GraphQL server libraries. Contact us at suppot@apollogrqphql.com if you're interested in joining the community to work on support for "},{"type":"raw","value":"<code class=\"language-text\">express-graphql</code>"},{"type":"text","value":" or non-Node GraphQL servers."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"2-add-cache-hints-to-your-responses"},"children":[{"type":"element","tagName":"a","properties":{"href":"#2-add-cache-hints-to-your-responses","aria-label":"2 add cache hints to your responses permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"2. Add cache hints to your responses"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Next we'll add some cache hints to our GarphQL responses. There are two ways to do this -- either dynamically in your resolvers or statically on your schema types and fields. Each "},{"type":"raw","value":"<code class=\"language-text\">cacheControl</code>"},{"type":"text","value":" hint has two parameters:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":" parameter defines the number of seconds that Engine Proxy should serve the cached response."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The "},{"type":"raw","value":"<code class=\"language-text\">scope</code>"},{"type":"text","value":" parameter declares that a unique response should be cached for every user ("},{"type":"raw","value":"<code class=\"language-text\">PRIVATE</code>"},{"type":"text","value":") or a single response should be cached for all users ("},{"type":"raw","value":"<code class=\"language-text\">PUBLIC</code>"},{"type":"text","value":"/default)."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Interpreting "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":" for a query (how long the query can be cached for):"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To determine the expiration time of a particular query, the Engine proxy looks at all of the "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":" hints returned by the server, which have been set on a per-field basis, and picks the shortest."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For example, the following trace indicates a 4 minute ("},{"type":"raw","value":"<code class=\"language-text\">maxAge = 240</code>"},{"type":"text","value":") for one field and 1 min ("},{"type":"raw","value":"<code class=\"language-text\">maxAge = 60</code>"},{"type":"text","value":") for another. This means that the Engine proxy will use \"1 minute\" as the overall expiration time for the whole result. You can use the Trace view in the Engine UI to understand your cache hit rates and the overall "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":" for your queries:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"../img/warthog-engine/cache-hints.png","alt":"Cache hints"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Note:"}]},{"type":"text","value":" If your query calls a type with a field referencing list of type objects, such as "},{"type":"raw","value":"<code class=\"language-text\">[Post]</code>"},{"type":"text","value":" referencing "},{"type":"raw","value":"<code class=\"language-text\">Author</code>"},{"type":"text","value":" in the "},{"type":"raw","value":"<code class=\"language-text\">author</code>"},{"type":"text","value":" field, Engine will consider the "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":" of the "},{"type":"raw","value":"<code class=\"language-text\">Author</code>"},{"type":"text","value":" type as well."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Setting cache scope for a query (public vs. private):"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Warthog Engine supports caching of personalized responses using the "},{"type":"raw","value":"<code class=\"language-text\">scope: PRIVATE</code>"},{"type":"text","value":" cache hint. Private caching requires that Engine identify unique users, using the methods defined in the "},{"type":"raw","value":"<code class=\"language-text\">sessionAuth</code>"},{"type":"text","value":" configuration section."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Engine supports extracting users' identity from an HTTP header (specified in "},{"type":"raw","value":"<code class=\"language-text\">header</code>"},{"type":"text","value":"), or an HTTP cookie (specified in "},{"type":"raw","value":"<code class=\"language-text\">cookie</code>"},{"type":"text","value":")."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For security, Engine can be configured to verify the extracted identity before serving a cached response. This allows your service to verify the session is still valid and avoid replay attacks.\nThis verification is performed by HTTP request, to the URL specified in "},{"type":"raw","value":"<code class=\"language-text\">tokenAuthUrl</code>"},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The token auth URL will receive an HTTP POST containing: "},{"type":"raw","value":"<code class=\"language-text\">{&quot;token&quot;: &quot;AUTHENTICATION-TOKEN&quot;}</code>"},{"type":"text","value":".\nIt should return an HTTP "},{"type":"raw","value":"<code class=\"language-text\">200</code>"},{"type":"text","value":" response if the token is still considered valid.\nIt may optionally return a JSON body:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">{&quot;ttl&quot;: 300}</code>"},{"type":"text","value":" to indicate the session token check can be cached for 300 seconds."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">{&quot;id&quot;: &quot;alice&quot;}</code>"},{"type":"text","value":" to indicate an internal user ID that should be used for identification. By returning a persistent identifier such as a database key, Engine's cache can follow a user across sessions and devices."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">{&quot;ttl&quot;: 600, &quot;id&quot;: &quot;bob&quot;}</code>"},{"type":"text","value":" to combine both."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Authentication checks with "},{"type":"raw","value":"<code class=\"language-text\">ttl&gt;0</code>"},{"type":"text","value":" will be cached in a "},{"type":"raw","value":"<code class=\"language-text\">store</code>"},{"type":"text","value":" named in "},{"type":"raw","value":"<code class=\"language-text\">sessionAuth</code>"},{"type":"text","value":", or in the default 50MB in-memory store."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Setting static cache hints in your schema:"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Cache hints can be added to your schema using directives on your types and fields. When executing your query, these hints will be added to the response and interpreted by Engine to compute a cache policy for the response."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Engine sets cache TTL as the lowest "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":" in the query path."}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-graphql line-numbers\"><code class=\"language-graphql\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">Post</span> <span class=\"token directive function\">@cacheControl</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">maxAge</span><span class=\"token punctuation\">:</span> <span class=\"token number\">240</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token attr-name\">id</span><span class=\"token punctuation\">:</span> Int<span class=\"token operator\">!</span>\n  <span class=\"token attr-name\">title</span><span class=\"token punctuation\">:</span> String\n  <span class=\"token attr-name\">author</span><span class=\"token punctuation\">:</span> Author\n  <span class=\"token attr-name\">votes</span><span class=\"token punctuation\">:</span> Int <span class=\"token directive function\">@cacheControl</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">maxAge</span><span class=\"token punctuation\">:</span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span>\n  <span class=\"token attr-name\">readByCurrentUser</span><span class=\"token punctuation\">:</span> Boolean<span class=\"token operator\">!</span> <span class=\"token directive function\">@cacheControl</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">scope</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">PRIVATE</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">Author</span> <span class=\"token directive function\">@cacheControl</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">maxAge</span><span class=\"token punctuation\">:</span> <span class=\"token number\">60</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token attr-name\">id</span><span class=\"token punctuation\">:</span> Int\n  <span class=\"token attr-name\">firstName</span><span class=\"token punctuation\">:</span> String\n  <span class=\"token attr-name\">lastName</span><span class=\"token punctuation\">:</span> String\n  <span class=\"token attr-name\">posts</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>Post<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You should receive cache control data in the "},{"type":"raw","value":"<code class=\"language-text\">extensions</code>"},{"type":"text","value":" field of your response:"}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\"><span class=\"token property\">\"cacheControl\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"hints\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"path\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"post\"</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"maxAge\"</span><span class=\"token operator\">:</span> <span class=\"token number\">240</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"path\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"post\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"votes\"</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"maxAge\"</span><span class=\"token operator\">:</span> <span class=\"token number\">30</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"path\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"post\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"readByCurrentUser\"</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"scope\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"PRIVATE\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For the above schema, there are a few ways to generate different TTLs depending on your query. Take the following examples:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Example 1"}]}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-graphql line-numbers\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> getPostsForAuthor <span class=\"token punctuation\">{</span>\n  Author <span class=\"token punctuation\">{</span>\n    posts\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">getPostsForAuthor</code>"},{"type":"text","value":" will have "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":" of 60 seconds, even though the "},{"type":"raw","value":"<code class=\"language-text\">Post</code>"},{"type":"text","value":" object has "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":" of 240 seconds."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Example 2"}]}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-graphql line-numbers\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> getTitleForPost <span class=\"token punctuation\">{</span>\n  Post <span class=\"token punctuation\">{</span>\n    title\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">getTitleForPost</code>"},{"type":"text","value":" will have "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":" of 240 seconds (inherited from Post), even though the "},{"type":"raw","value":"<code class=\"language-text\">title</code>"},{"type":"text","value":" field has no "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":" specified."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Example 3"}]}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-graphql line-numbers\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> getVotesForPost <span class=\"token punctuation\">{</span>\n  Post <span class=\"token punctuation\">{</span>\n    votes\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">getVotesForPost</code>"},{"type":"text","value":" will have "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":" of 240 seconds, even though the "},{"type":"raw","value":"<code class=\"language-text\">votes</code>"},{"type":"text","value":" field has a higher "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Setting dynamic cache hints in your resolvers:"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you'd like to add cache hints dynamically, you can use a programmatic API from within your resolvers."}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> resolvers <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  Query<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">post</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">_<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> id <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> _<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> cacheControl <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      cacheControl<span class=\"token punctuation\">.</span><span class=\"token function\">setCacheHint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> maxAge<span class=\"token punctuation\">:</span> <span class=\"token number\">60</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">find</span><span class=\"token punctuation\">(</span>posts<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> id <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Setting a default "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":" for your whole schema:"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The power of cache hints comes from being able to set them precisely to different values on different types and fields based on your understanding of your implementation's semantics. But when getting started, you might just want to apply the same "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":" to most of your resolvers. You can specify a default max age when you set up "},{"type":"raw","value":"<code class=\"language-text\">cacheControl</code>"},{"type":"text","value":" in your server. This max age will be applied to all resolvers which don't explicitly set "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":" via schema hints (including schema hints on the type that they return) or the programmatic API. You can override this for a particular resolver or type by setting "},{"type":"raw","value":"<code class=\"language-text\">@cacheControl(maxAge: 0)</code>"},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Just like when you set "},{"type":"raw","value":"<code class=\"language-text\">@cacheControl(maxAge: 5)</code>"},{"type":"text","value":" explicitly on a field or a type, data is considered to be public by default and the cache will be shared among all users of your site, so when using this option, be sure that you're really OK with creating a shared cache for all of your GraphQL queries. You can still override a specific type or resolver to use the private cache by setting "},{"type":"raw","value":"<code class=\"language-text\">@cacheControl(scope: PRIVATE)</code>"},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For example, for Express:"}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">'/graphql'</span><span class=\"token punctuation\">,</span>\n  bodyParser<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">graphqlExpress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    schema<span class=\"token punctuation\">,</span>\n    context<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    tracing<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    cacheControl<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      defaultMaxAge<span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Setting "},{"type":"raw","value":"<code class=\"language-text\">defaultMaxAge</code>"},{"type":"text","value":" requires "},{"type":"raw","value":"<code class=\"language-text\">warthog-server-*</code>"},{"type":"text","value":" 1.3.4 or newer."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"3-optional-configure-cache-options"},"children":[{"type":"element","tagName":"a","properties":{"href":"#3-optional-configure-cache-options","aria-label":"3 optional configure cache options permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"3. Optional: Configure cache options"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As long as you're using a version of the Engine proxy that's greater than "},{"type":"raw","value":"<code class=\"language-text\">1.0</code>"},{"type":"text","value":", you won't have to configure anything to use public response caching. The proxy comes with a default 50MB in-memory cache. To enable private response caching or to configure details of how caching works, there are a few fields in the Engine configuration (ie, argument to "},{"type":"raw","value":"<code class=\"language-text\">new ApolloServer</code>"},{"type":"text","value":") that are relevant."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Here is an example of changing the Engine config for caching "},{"type":"raw","value":"<code class=\"language-text\">scope: PUBLIC</code>"},{"type":"text","value":" responses to use memcached instead of an in-memory cache.\nSince no "},{"type":"raw","value":"<code class=\"language-text\">privateFullQueryStore</code>"},{"type":"text","value":" is provided, "},{"type":"raw","value":"<code class=\"language-text\">scope: PRIVATE</code>"},{"type":"text","value":" responses will not be cached."}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> engine <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloEngine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  stores<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      memcache<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        url<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'localhost:4567'</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Below is an example of an Engine config for caching "},{"type":"raw","value":"<code class=\"language-text\">scope: PUBLIC</code>"},{"type":"text","value":" and "},{"type":"raw","value":"<code class=\"language-text\">scope: PRIVATE</code>"},{"type":"text","value":" responses, using the default (empty-string-named 50MB in-memory cache) for public responses and authorization tokens, and memcached for private responses.\nBy using a private response cache, we guarantee that a response affecting multiple users is never evicted for a response affecting only a single user."}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> engine <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloEngine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  stores<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      name<span class=\"token punctuation\">:</span> <span class=\"token string\">'privateResponseMemcache'</span><span class=\"token punctuation\">,</span>\n      memcache<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        url<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'localhost:4567'</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  sessionAuth<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    header<span class=\"token punctuation\">:</span> <span class=\"token string\">'Authorization'</span><span class=\"token punctuation\">,</span>\n    tokenAuthUrl<span class=\"token punctuation\">:</span> <span class=\"token string\">'https://auth.mycompany.com/engine-auth-check'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  queryCache<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    privateFullQueryStore<span class=\"token punctuation\">:</span> <span class=\"token string\">'privateResponseMemcache'</span>\n    <span class=\"token comment\">// By not mentioning publicFullQueryStore, we keep it enabled with</span>\n    <span class=\"token comment\">// the default empty-string-named in-memory store.</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"stores"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Stores is an array of places for Engine to store data such as: query responses, authentication checks, or persisted queries."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Every store must have a unique "},{"type":"raw","value":"<code class=\"language-text\">name</code>"},{"type":"text","value":". The empty string is a valid name; there is a default in-memory 50MB cache with the empty string for its name which is used for any caching feature if you don't specify a store name. You can specify the name of "},{"type":"raw","value":"<code class=\"language-text\">&quot;disabled&quot;</code>"},{"type":"text","value":" to any caching feature to turn off that feature."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Engine supports two types of stores:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">inMemory</code>"},{"type":"text","value":" stores provide a bounded LRU cache embedded within the Engine Proxy.\nSince there's no external servers to configure, in-memory stores are the easiest to get started with.\nSince there's no network overhead, in-memory stores are the fastest option.\nHowever, if you're running multiple copies of Engine Proxy, their in-memory stores won't be shared --- a cache hit on one server may be a cache miss on another server.\nIn memory caches are wiped whenever Engine Proxy restarts."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The only configuration required for in memory stores is "},{"type":"raw","value":"<code class=\"language-text\">cacheSize</code>"},{"type":"text","value":" --- an upper limit specified in bytes. It defaults to 50MB."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">memcache</code>"},{"type":"text","value":" stores use external "},{"type":"element","tagName":"a","properties":{"href":"https://memcached.org/"},"children":[{"type":"text","value":"Memcached"}]},{"type":"text","value":" server(s) for persistence.\nThis provides a shared location for multiple copies of Engine Proxy to achieve the same cache hit rate.\nThis location is also not wiped across Engine Proxy restarts."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Memcache store configuration requires an array of addresses called "},{"type":"raw","value":"<code class=\"language-text\">url</code>"},{"type":"text","value":", for the memcached servers. (This name is misleading: the values are "},{"type":"raw","value":"<code class=\"language-text\">host:port</code>"},{"type":"text","value":" without any URL scheme like "},{"type":"raw","value":"<code class=\"language-text\">http://</code>"},{"type":"text","value":".) All addresses must contain both host and port, even if using the default memcached port. The AWS Elasticache discovery protocol is not currently supported.\n"},{"type":"raw","value":"<code class=\"language-text\">keyPrefix</code>"},{"type":"text","value":" may also be specified, to allow multiple environments to share a memcached server (i.e. dev/staging/production)."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We suggest developers start with an in-memory store, then upgrade to Memcached if the added deployment complexity is worth it for production.\nThis will give you much more control over memory usage and enable sharing the cache across multiple Engine proxy instances."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"sessionAuth"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This is useful when you want to do per-session response caching with Engine. To be able to cache results for a particular user, Engine needs to know how to identify a logged-in user. In this example, we've configured it to look for an "},{"type":"raw","value":"<code class=\"language-text\">Authorization</code>"},{"type":"text","value":" header, so private data will be stored with a key that's specific to the value of that header."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can specify that the session ID is defined by either a header or a cookie. Optionally, you can specify a REST endpoint which the Engine Proxy can use to determine whether a given token is valid."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"queryCache"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This maps the types of result caching Engine performs to the stores you've defined in the "},{"type":"raw","value":"<code class=\"language-text\">stores</code>"},{"type":"text","value":" field.\nIn this case, we're sending public and private cached data to unique stores, so that responses affecting multiple users will never be evicted for responses affecting a single user."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you leave "},{"type":"raw","value":"<code class=\"language-text\">queryCache.publicFullQueryStore</code>"},{"type":"text","value":" blank, it will use the default 50MB in-memory cache. Set it to "},{"type":"raw","value":"<code class=\"language-text\">&quot;disabled&quot;</code>"},{"type":"text","value":" to turn off the cache."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you configure "},{"type":"raw","value":"<code class=\"language-text\">sessionAuth</code>"},{"type":"text","value":" but leave "},{"type":"raw","value":"<code class=\"language-text\">queryCache.privateFullQueryStore</code>"},{"type":"text","value":" blank, it will use the default 50MB in-memory cache. Set it to "},{"type":"raw","value":"<code class=\"language-text\">&quot;disabled&quot;</code>"},{"type":"text","value":" to turn off the cache."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"visualizing-caching"},"children":[{"type":"element","tagName":"a","properties":{"href":"#visualizing-caching","aria-label":"visualizing caching permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Visualizing caching"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"One of the best parts about using caching via the Engine proxy is that you can easily see how it's working once you set it up. The Metrics views in the Engine UI show you exactly which responses are cached and which are not, so you can understand how caching is helping you make your server more performant. Here's what the Engine metrics charts look like when you have everything set up correctly:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"../img/warthog-engine/cache-metrics.png","alt":"Cache metrics charts"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"how-http-headers-affect-caching"},"children":[{"type":"element","tagName":"a","properties":{"href":"#how-http-headers-affect-caching","aria-label":"how http headers affect caching permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"How HTTP headers affect caching"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The main way that your GraphQL server specifies cache behavior is through the "},{"type":"raw","value":"<code class=\"language-text\">cacheControl</code>"},{"type":"text","value":" GraphQL extension, which is rendered in the body of a GraphQL response. However, Engine also understands and sets several caching-related HTTP headers."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"HTTP headers interpreted by Engine"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Engine will never decide to cache responses in its response cache unless you tell it to with the "},{"type":"raw","value":"<code class=\"language-text\">cacheControl</code>"},{"type":"text","value":" GraphQL extension. However, Engine does observe some HTTP headers and can use them to restrict caching further than what the extension says. These headers include:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">Cache-Control</code>"},{"type":"text","value":" "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"response"}]},{"type":"text","value":" header: If the "},{"type":"raw","value":"<code class=\"language-text\">Cache-Control</code>"},{"type":"text","value":" response header contains "},{"type":"raw","value":"<code class=\"language-text\">no-store</code>"},{"type":"text","value":", "},{"type":"raw","value":"<code class=\"language-text\">no-cache</code>"},{"type":"text","value":", or "},{"type":"raw","value":"<code class=\"language-text\">private</code>"},{"type":"text","value":", Engine will not cache the response. If the "},{"type":"raw","value":"<code class=\"language-text\">Cache-Control</code>"},{"type":"text","value":" response header contains "},{"type":"raw","value":"<code class=\"language-text\">max-age</code>"},{"type":"text","value":" or "},{"type":"raw","value":"<code class=\"language-text\">s-maxage</code>"},{"type":"text","value":" directives, then Engine will not cache any data for longer than the specified amount of time. (That is, data will be cached for the minimum of the header-provided "},{"type":"raw","value":"<code class=\"language-text\">max-age</code>"},{"type":"text","value":" and the extension-provided "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":".) "},{"type":"raw","value":"<code class=\"language-text\">s-maxage</code>"},{"type":"text","value":" takes precedence over "},{"type":"raw","value":"<code class=\"language-text\">max-age</code>"},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">Cache-Control</code>"},{"type":"text","value":" "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"request"}]},{"type":"text","value":" header: If the "},{"type":"raw","value":"<code class=\"language-text\">Cache-Control</code>"},{"type":"text","value":" request header contains "},{"type":"raw","value":"<code class=\"language-text\">no-cache</code>"},{"type":"text","value":", Engine will not look in the cache for responses. If the "},{"type":"raw","value":"<code class=\"language-text\">Cache-Control</code>"},{"type":"text","value":" request header contains "},{"type":"raw","value":"<code class=\"language-text\">no-store</code>"},{"type":"text","value":", Engine will not cache the response."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">Expires</code>"},{"type":"text","value":" response header: If the "},{"type":"raw","value":"<code class=\"language-text\">Expires</code>"},{"type":"text","value":" response header is present, then Engine will not cache any data past the given date. The "},{"type":"raw","value":"<code class=\"language-text\">Cache-Control</code>"},{"type":"text","value":" directives "},{"type":"raw","value":"<code class=\"language-text\">s-maxage</code>"},{"type":"text","value":" and "},{"type":"raw","value":"<code class=\"language-text\">max-age</code>"},{"type":"text","value":" take precedence over "},{"type":"raw","value":"<code class=\"language-text\">Expires</code>"},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">Vary</code>"},{"type":"text","value":" response header: If the "},{"type":"raw","value":"<code class=\"language-text\">Vary</code>"},{"type":"text","value":" response header is present, then Engine will not return this response to any request whose headers named in the "},{"type":"raw","value":"<code class=\"language-text\">Vary</code>"},{"type":"text","value":" header don't match the request that created this response. (For example, if a request had a "},{"type":"raw","value":"<code class=\"language-text\">Accept-Language: de</code>"},{"type":"text","value":" header and the response had a "},{"type":"raw","value":"<code class=\"language-text\">Vary: Accept-Language</code>"},{"type":"text","value":" header, then that response won't be returned from the cache to any response that does not also have a "},{"type":"raw","value":"<code class=\"language-text\">Accept-Language: de</code>"},{"type":"text","value":" header.) Additionally, Engine uses a heuristic to store requests that have different values for headers that it suspects may show up in the response "},{"type":"raw","value":"<code class=\"language-text\">Vary</code>"},{"type":"text","value":" header under different cache keys; currently that heuristic is that it assumes that any header that has ever shown up in a "},{"type":"raw","value":"<code class=\"language-text\">Vary</code>"},{"type":"text","value":" header in a GraphQL response may be relevant."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"HTTP headers set by Engine"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When returning a GraphQL response which is eligible for the full-query cache (ie, all of the data has a non-zero "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":" set in the "},{"type":"raw","value":"<code class=\"language-text\">cacheControl</code>"},{"type":"text","value":" GraphQL extension), Engine sets the "},{"type":"raw","value":"<code class=\"language-text\">Cache-Control</code>"},{"type":"text","value":" header with a "},{"type":"raw","value":"<code class=\"language-text\">max-age</code>"},{"type":"text","value":" directive equal to the minimum "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":" of all data in the response. If any of the data in the response has a "},{"type":"raw","value":"<code class=\"language-text\">scope: PRIVATE</code>"},{"type":"text","value":" hint, the "},{"type":"raw","value":"<code class=\"language-text\">Cache-Control</code>"},{"type":"text","value":" header will include the "},{"type":"raw","value":"<code class=\"language-text\">private</code>"},{"type":"text","value":" directive; otherwise it will include the "},{"type":"raw","value":"<code class=\"language-text\">public</code>"},{"type":"text","value":" directive. This header completely replaces any "},{"type":"raw","value":"<code class=\"language-text\">Cache-Control</code>"},{"type":"text","value":" and "},{"type":"raw","value":"<code class=\"language-text\">Expires</code>"},{"type":"text","value":" headers provided by your GraphQL server."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"cdn-integration"},"children":[{"type":"element","tagName":"a","properties":{"href":"#cdn-integration","aria-label":"cdn integration permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"CDN integration"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Many high-traffic web services use content delivery networks (CDNs) such as "},{"type":"element","tagName":"a","properties":{"href":"https://www.cloudflare.com/"},"children":[{"type":"text","value":"Cloudflare"}]},{"type":"text","value":", "},{"type":"element","tagName":"a","properties":{"href":"https://www.akamai.com/"},"children":[{"type":"text","value":"Akamai"}]},{"type":"text","value":" or "},{"type":"element","tagName":"a","properties":{"href":"https://www.fastly.com/"},"children":[{"type":"text","value":"Fastly"}]},{"type":"text","value":" to cache their content as close to their clients as possible."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Warthog Server 2 supports CDN integration out of the box and doesn't require the Engine Proxy. To learn how, read through the "},{"type":"element","tagName":"a","properties":{"href":"https://www.warthog.dev/docs/warthog-server/features/apq#cdn"},"children":[{"type":"text","value":"guide on CDN integration"}]},{"type":"text","value":". For other server implementations, the Engine Proxy makes it straightforward to use CDNs with GraphQL queries whose responses can be cached while still passing more dynamic queries through to your GraphQL server."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To use the Engine proxy behind a CDN, you need to be able to tell the CDN which GraphQL responses it's allowed to cache and you need to make sure that your GraphQL requests arrive in a format that CDNs cache. Engine Proxy supports this by combining its "},{"type":"element","tagName":"a","properties":{"href":"#caching"},"children":[{"type":"text","value":"caching"}]},{"type":"text","value":" and "},{"type":"element","tagName":"a","properties":{"href":"#automatic-persisted-queries-apq"},"children":[{"type":"text","value":"automatic persisted queries"}]},{"type":"text","value":" featues. This section explains the basic steps for setting up these features to work with CDNs; for more details on how to configure these features, see their respective sections."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"1-set-up-caching-using-warthog-cache-contol"},"children":[{"type":"element","tagName":"a","properties":{"href":"#1-set-up-caching-using-warthog-cache-contol","aria-label":"1 set up caching using warthog cache contol permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"1. Set up caching using Warthog Cache Contol"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You'll need to follow the guide in the "},{"type":"element","tagName":"a","properties":{"href":"#caching"},"children":[{"type":"text","value":"caching"}]},{"type":"text","value":" section to set up your server to extend its requests with cache hint extensions."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Once you have your server sending responses with cache hints in the "},{"type":"raw","value":"<code class=\"language-text\">response.extensions</code>"},{"type":"text","value":" your Engine proxy will start serving the HTTP "},{"type":"raw","value":"<code class=\"language-text\">Cache-Control</code>"},{"type":"text","value":" header on the "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"fully cacheable"}]},{"type":"text","value":" responses (any response containing only data with non-zero "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":" annotations). The header will refer to the minimum "},{"type":"raw","value":"<code class=\"language-text\">maxAge</code>"},{"type":"text","value":" value across the whole response, and it will be "},{"type":"raw","value":"<code class=\"language-text\">public</code>"},{"type":"text","value":" unless some of the data is tagged "},{"type":"raw","value":"<code class=\"language-text\">scope: PRIVATE</code>"},{"type":"text","value":". You should be able to observe this header in your browser's dev tools. The Engine proxy will also cache the responses in its own default public in-memory cache."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"2-set-up-automatic-persisted-queries"},"children":[{"type":"element","tagName":"a","properties":{"href":"#2-set-up-automatic-persisted-queries","aria-label":"2 set up automatic persisted queries permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"2. Set up automatic persisted queries"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"At this point, GraphQL requetss are still POST requests. Most CDNs will only cache GET requests, and GET requests generally work best if the URL is of a bounded size. To work with this, enable Warthog Engine Proxy's Automatic Persisted Queries (APQ) support. This allows clients to send short hashes instead of full queries, and you can configure it to use GET requests for those queries."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To do this, follow the steps in the "},{"type":"element","tagName":"a","properties":{"href":"#automatic-persisted-queries-apq"},"children":[{"type":"text","value":"guide above"}]},{"type":"text","value":". After completing the steps in that section of the guide, you should be able to observe queries being sent as "},{"type":"raw","value":"<code class=\"language-text\">GET</code>"},{"type":"text","value":" requests with the appropriate "},{"type":"raw","value":"<code class=\"language-text\">Cache-Control</code>"},{"type":"text","value":" response headers using your browser's developer tools."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"3-set-up-your-cdn"},"children":[{"type":"element","tagName":"a","properties":{"href":"#3-set-up-your-cdn","aria-label":"3 set up your cdn permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"3. Set up your CDN"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"How precisely this works relies upon which CDN you chose. Configure your CDN to send requests to your Engine proxy-powered GraphQL app. For some CDNs, you may need to specially configure your CDN to honor origin Cache-Control headers. For example, here is "},{"type":"element","tagName":"a","properties":{"href":"https://learn.akamai.com/en-us/webhelp/ion/oca/GUID-57C31126-F745-4FFB-AA92-6A5AAC36A8DA.html"},"children":[{"type":"text","value":"Akamai's documentation on that setting"}]},{"type":"text","value":". If all is well, your cacheable queries should now be cached by your CDN! Note that requests served directly by your CDN will not show up in your Engine dashboard."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"query-batching"},"children":[{"type":"element","tagName":"a","properties":{"href":"#query-batching","aria-label":"query batching permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Query batching"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Query batching allows your client to batch multiple queries into one request. This means that if you render several view components within a short time interval, for example a navbar, sidebar, and content, and each of those do their own GraphQL query, the queries can be sent together in a single roundtrip."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A batch of queries can be sent by simply sending a JSON-encoded array of queries in the request:"}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">[</span>\n <span class=\"token punctuation\">{</span> <span class=\"token string\">\"query\"</span><span class=\"token punctuation\">:</span> \"<span class=\"token punctuation\">{</span>\n  <span class=\"token function\">feed</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">limit<span class=\"token punctuation\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">:</span> <span class=\"token constant\">NEW</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    postedBy <span class=\"token punctuation\">{</span>\n      login\n    <span class=\"token punctuation\">}</span>\n    repository <span class=\"token punctuation\">{</span>\n      name\n      owner <span class=\"token punctuation\">{</span>\n        login\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\" <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">{</span> <span class=\"token string\">\"query\"</span><span class=\"token punctuation\">:</span> \"query CurrentUserForLayout <span class=\"token punctuation\">{</span>\n  currentUser <span class=\"token punctuation\">{</span>\n    __typename\n    avatar_url\n    login\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\" <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Batched requests to servers that don’t support batching fail without explicit code to handle batching, however the Engine proxy has batched request handling built-in."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If a batch of queries is sent, the batches are fractured by the Engine proxy and individual queries are sent to origins in parallel. Engine will wait for all the responses to complete and send a single response back to the client. The response will be an array of GraphQL results:"}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    data<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      feed<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n          postedBy<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n            login<span class=\"token punctuation\">:</span> <span class=\"token string\">'AleksandraKaminska'</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          repository<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n            name<span class=\"token punctuation\">:</span> <span class=\"token string\">'GitHubApp'</span><span class=\"token punctuation\">,</span>\n            owner<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n              login<span class=\"token punctuation\">:</span> <span class=\"token string\">'AleksandraKaminska'</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n          postedBy<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n            login<span class=\"token punctuation\">:</span> <span class=\"token string\">'ashokhein'</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          repository<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n            name<span class=\"token punctuation\">:</span> <span class=\"token string\">'memeryde'</span><span class=\"token punctuation\">,</span>\n            owner<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n              login<span class=\"token punctuation\">:</span> <span class=\"token string\">'ashokhein'</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    data<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      currentUser<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        __typename<span class=\"token punctuation\">:</span> <span class=\"token string\">'User'</span><span class=\"token punctuation\">,</span>\n        avatar_url<span class=\"token punctuation\">:</span> <span class=\"token string\">'https://avatars2.githubusercontent.com/u/11861843?v=4'</span><span class=\"token punctuation\">,</span>\n        login<span class=\"token punctuation\">:</span> <span class=\"token string\">'johannakate'</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If your origin supports batching and you'd like to pass entire batches through instead of having the Engine proxy break them up, set "},{"type":"raw","value":"<code class=\"language-text\">supportsBatch: true</code>"},{"type":"text","value":" within the origins section of the configuration:"}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> engine <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloEngine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  apiKey<span class=\"token punctuation\">:</span> <span class=\"token string\">'ENGINE_API_KEY'</span><span class=\"token punctuation\">,</span>\n  origins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      supportsBatch<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"batching-in-warthog-client-with-engine"},"children":[{"type":"element","tagName":"a","properties":{"href":"#batching-in-warthog-client-with-engine","aria-label":"batching in warthog client with engine permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Batching in Warthog Client with Engine"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Warthog Client has built-in support for batching queries in your client application. To learn how to use query batching with Warthog Client, visit the in-depth guide on our package "},{"type":"element","tagName":"a","properties":{"href":"https://www.warthog.dev/docs/link/links/batch-http/"},"children":[{"type":"raw","value":"<code class=\"language-text\">warthog-link-batch-http</code>"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you have questions, we're always available at support@warthog.dev."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"proxy-configuration"},"children":[{"type":"element","tagName":"a","properties":{"href":"#proxy-configuration","aria-label":"proxy configuration permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Proxy configuration"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"View our "},{"type":"element","tagName":"a","properties":{"href":"/references/proxy-config/"},"children":[{"type":"text","value":"full proxy configuration doc"}]},{"type":"text","value":" for information on every available configuration option for the Engine proxy."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"release-notes"},"children":[{"type":"element","tagName":"a","properties":{"href":"#release-notes","aria-label":"release notes permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Release notes"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"View our "},{"type":"element","tagName":"a","properties":{"href":"/references/engine-proxy-release-notes/"},"children":[{"type":"text","value":"proxy release notes doc"}]},{"type":"text","value":" for documentation on each proxy version that's been released and a changelog of what that version contained."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"troubleshooting"},"children":[{"type":"element","tagName":"a","properties":{"href":"#troubleshooting","aria-label":"troubleshooting permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Troubleshooting"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"check-that-your-server-is-supported"},"children":[{"type":"element","tagName":"a","properties":{"href":"#check-that-your-server-is-supported","aria-label":"check that your server is supported permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Check that your server is supported"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Check that your server is one of the supported GraphQL servers listed "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/goldcaddy77/warthog-tracing#supported-graphql-servers"},"children":[{"type":"text","value":"here"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If it is, please make sure you're running the "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/goldcaddy77/warthog-engine-js/blob/master/package.json"},"children":[{"type":"text","value":"currently tested version"}]},{"type":"text","value":" of Warthog Server and your Node HTTP server package (Express, Connect, Hapi, Koa, etc), and the latest released versions of the Engine and Warthog packages."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can enter the following into the commandline to see the latest package version, or look in "},{"type":"raw","value":"<code class=\"language-text\">package.json</code>"},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">$ npm view warthog-engine version</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"set-debug-logging-levels-for-the-proxy"},"children":[{"type":"element","tagName":"a","properties":{"href":"#set-debug-logging-levels-for-the-proxy","aria-label":"set debug logging levels for the proxy permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Set debug logging levels for the Proxy"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Support may request that you set the Engine Proxy logging level to DEBUG or higher. These logs will be part of your GraphQL server logs (if Proxy is deployed with the "},{"type":"raw","value":"<code class=\"language-text\">ApolloEngine</code>"},{"type":"text","value":" Node API) or in the Proxy process logs (if Proxy is deployed standalone)."}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> engine <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloEngine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  logging<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    level<span class=\"token punctuation\">:</span> <span class=\"token string\">'DEBUG'</span> <span class=\"token comment\">// Engine Proxy logging level. DEBUG, INFO, WARN or ERROR</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"ensure-you-enabled-warthog-tracing"},"children":[{"type":"element","tagName":"a","properties":{"href":"#ensure-you-enabled-warthog-tracing","aria-label":"ensure you enabled warthog tracing permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Ensure you enabled Warthog Tracing"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Test that you enabled Warthog Tracing by checking if your GraphQL server returns trace extensions in GraphQL responses when not executed through Engine. If it does, it's is a sign that Warthog Tracing is properly configured."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"troubleshooting-faqs"},"children":[{"type":"element","tagName":"a","properties":{"href":"#troubleshooting-faqs","aria-label":"troubleshooting faqs permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Troubleshooting FAQs"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"im-getting-an-error-saying-the-query-failed-how-do-i-fix-it"},"children":[{"type":"element","tagName":"a","properties":{"href":"#im-getting-an-error-saying-the-query-failed-how-do-i-fix-it","aria-label":"im getting an error saying the query failed how do i fix it permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"I'm getting an error saying “The query failed!”, how do I fix it?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This may mean you need to upgrade an NPM package. Check that your package versions are all up-to-date. This also may mean a variety of other things. When this error is paired with a 503 error, the query did not receive an expected response."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"why-isnt-data-showing-up-in-my-dashboard"},"children":[{"type":"element","tagName":"a","properties":{"href":"#why-isnt-data-showing-up-in-my-dashboard","aria-label":"why isnt data showing up in my dashboard permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Why isn't data showing up in my dashboard?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We recommend double-checking that the Engine API key for the correct service is specified in the "},{"type":"raw","value":"<code class=\"language-text\">ApolloEngine</code>"},{"type":"text","value":" constructor."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"how-do-i-check-that-the-engine-proxy-is-up-and-running"},"children":[{"type":"element","tagName":"a","properties":{"href":"#how-do-i-check-that-the-engine-proxy-is-up-and-running","aria-label":"how do i check that the engine proxy is up and running permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"How do I check that the Engine Proxy is up and running?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There is a health check URL at "},{"type":"raw","value":"<code class=\"language-text\">[engine-frontend-url]/.well-known/warthog/engine-health</code>"},{"type":"text","value":", which returns an HTTP status of 200 if the server is running."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"what-is-shown-on-the-engine-proxy-logs"},"children":[{"type":"element","tagName":"a","properties":{"href":"#what-is-shown-on-the-engine-proxy-logs","aria-label":"what is shown on the engine proxy logs permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"What is shown on the Engine Proxy logs?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Each time the Engine proxy starts, you should see the following two lines in the logs indicating the Engine proxy is healthy:"}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"console\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-console line-numbers\"><code class=\"language-console\">INFO[0000] Started HTTP server.                          address=&quot;[::]:50485&quot;\nINFO[0000] Engine proxy started.                         version=2018.02-93-ge050c6b93</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"These lines say what port Engine is listening on and the internal version number for the Proxy. If you don't want to see them, set the log level to 'WARN'"}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> engine <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloEngine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  logging<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    level<span class=\"token punctuation\">:</span> <span class=\"token string\">'WARN'</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"submit-a-support-ticket"},"children":[{"type":"element","tagName":"a","properties":{"href":"#submit-a-support-ticket","aria-label":"submit a support ticket permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Submit a support ticket"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Please include the following when submitting an issue to our support team:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Platform of GraphQL server"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Are you using "},{"type":"raw","value":"<code class=\"language-text\">new ApolloEngine</code>"},{"type":"text","value":", "},{"type":"raw","value":"<code class=\"language-text\">new ApolloEngineLauncher</code>"},{"type":"text","value":", or the Docker container?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Engine configuration: arguments to "},{"type":"raw","value":"<code class=\"language-text\">new ApolloEngine</code>"},{"type":"text","value":" or "},{"type":"raw","value":"<code class=\"language-text\">new ApolloEngineLauncher</code>"},{"type":"text","value":", or the JSON configuration file for the Docker container"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Platform of GraphQL server"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The query submitted and the full response"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Submit your issue to support at warthog.dev or you can join us in "},{"type":"element","tagName":"a","properties":{"href":"https://spectrum.chat/warthog"},"children":[{"type":"text","value":"Warthog's Spectrum community"}]},{"type":"text","value":"."}]}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":861,"column":129,"offset":49155}}}}