{"expireTime":9007200819376323000,"key":"transformer-remark-markdown-html-ast-9f12ff7a73027296716b6eb46ae4fc06-gatsby-remark-autolink-headersgatsby-remark-copy-linked-filesgatsby-remark-prismjsgatsby-remark-check-links-","val":{"type":"root","children":[{"type":"raw","value":"<!-- Please leave this file here, it's a destination for redirects from the migration guide in the old Engine proxy docs. It does not have any direct links to it in the Platform docs, but that doesn't mean there are no link on the internet that still come here. -->"},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Version 1.0 of the npm "},{"type":"raw","value":"<code class=\"language-text\">warthog-engine</code>"},{"type":"text","value":" package replaces the "},{"type":"raw","value":"<code class=\"language-text\">Engine</code>"},{"type":"text","value":" API with a streamlined "},{"type":"raw","value":"<code class=\"language-text\">ApolloEngine</code>"},{"type":"text","value":" API. It's straightforward to upgrade your app to the 1.0 API."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"migrating-from-engine-to-apolloengine"},"children":[{"type":"element","tagName":"a","properties":{"href":"#migrating-from-engine-to-apolloengine","aria-label":"migrating from engine to apolloengine permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Migrating from "},{"type":"raw","value":"<code class=\"language-text\">Engine</code>"},{"type":"text","value":" to "},{"type":"raw","value":"<code class=\"language-text\">ApolloEngine</code>"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A typical use of the pre-1.0 "},{"type":"raw","value":"<code class=\"language-text\">Engine</code>"},{"type":"text","value":" API with an Express server looked like:"}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Engine <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'warthog-engine'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// create new engine instance from JS config object</span>\n<span class=\"token keyword\">const</span> engine <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Engine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  engineConfig<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    apiKey<span class=\"token punctuation\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">ENGINE_API_KEY</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  endpoint<span class=\"token punctuation\">:</span> <span class=\"token string\">'/api/graphql'</span><span class=\"token punctuation\">,</span>\n  graphqlPort<span class=\"token punctuation\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">,</span>\n  startupTimeout<span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">await</span> engine<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// The next line is slightly different on different Node web frameworks.</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">.</span><span class=\"token function\">expressMiddleware</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// This is the standard Express API:</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Listening!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The equivalent in the v1 "},{"type":"raw","value":"<code class=\"language-text\">ApolloEngine</code>"},{"type":"text","value":" API looks like:"}]},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ApolloEngine <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'warthog-engine'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> engine <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloEngine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  apiKey<span class=\"token punctuation\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">ENGINE_API_KEY</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// No engine.start() or app.use() required!</span>\n\n<span class=\"token comment\">// Instead of app.listen():</span>\nengine<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  port<span class=\"token punctuation\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">,</span>\n  graphqlPaths<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'/api/graphql'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  expressApp<span class=\"token punctuation\">:</span> app<span class=\"token punctuation\">,</span>\n  launcherOptions<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    startupTimeout<span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Listening!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Notable differences:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The API is now called "},{"type":"raw","value":"<code class=\"language-text\">ApolloEngine</code>"},{"type":"text","value":" rather than "},{"type":"raw","value":"<code class=\"language-text\">Engine</code>"},{"type":"text","value":". (We changed the name so that people still using "},{"type":"raw","value":"<code class=\"language-text\">new Engine</code>"},{"type":"text","value":" get shown a link to this page!)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The "},{"type":"element","tagName":"a","properties":{"href":"/references/proxy-config/"},"children":[{"type":"text","value":"engine configuration"}]},{"type":"text","value":" is the main argument to "},{"type":"raw","value":"<code class=\"language-text\">new ApolloEngine</code>"},{"type":"text","value":" rather than nested inside an "},{"type":"raw","value":"<code class=\"language-text\">engineConfig</code>"},{"type":"text","value":" option. The \"engine configuration\" is the configuration presented to the underlying Engine Proxy binary; other options affect the Node code rather than the inner process.  We moved all the options that configure the Node code to the "},{"type":"raw","value":"<code class=\"language-text\">listen</code>"},{"type":"text","value":" call so that it's easy to differentiate between \"configuring the Proxy's behavior\" and \"configuring how we talk to the Proxy binary\"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"You don't need to tell Engine to "},{"type":"raw","value":"<code class=\"language-text\">start()</code>"},{"type":"text","value":", nor do you need to connect it to your web framework's middleware at a carefully chosen location. Instead, you replace your web framework's "},{"type":"raw","value":"<code class=\"language-text\">app.listen()</code>"},{"type":"text","value":" call with an "},{"type":"raw","value":"<code class=\"language-text\">engine.listen</code>"},{"type":"text","value":" call.  See "},{"type":"element","tagName":"a","properties":{"href":"/references/engine-proxy/#option-2-running-a-standalone-proxy-using-node"},"children":[{"type":"text","value":"the Node setup guide"}]},{"type":"text","value":" for how to connect Engine to a web framework other than Express."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Engine now supports the Restify web framework and version 17 of the Hapi web framework. It is also relatively straightforward to use it with any web framework that works with Node's "},{"type":"raw","value":"<code class=\"language-text\">http.Server</code>"},{"type":"text","value":" class."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"You don't need to specify your GraphQL server's port twice (once in the "},{"type":"raw","value":"<code class=\"language-text\">graphqlPort</code>"},{"type":"text","value":" option to "},{"type":"raw","value":"<code class=\"language-text\">new Engine</code>"},{"type":"text","value":" and once to "},{"type":"raw","value":"<code class=\"language-text\">app.listen</code>"},{"type":"text","value":"). You just specify it once to "},{"type":"raw","value":"<code class=\"language-text\">engine.listen</code>"},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The "},{"type":"raw","value":"<code class=\"language-text\">endpoint</code>"},{"type":"text","value":" option to "},{"type":"raw","value":"<code class=\"language-text\">new Engine()</code>"},{"type":"text","value":" is now the "},{"type":"raw","value":"<code class=\"language-text\">graphqlPaths</code>"},{"type":"text","value":" option to "},{"type":"raw","value":"<code class=\"language-text\">engine.listen()</code>"},{"type":"text","value":", and it takes an array of paths instead of just one. You still don't need to specify it if your GraphQL server is mounted at "},{"type":"raw","value":"<code class=\"language-text\">/graphql</code>"},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The "},{"type":"raw","value":"<code class=\"language-text\">origin</code>"},{"type":"text","value":" and "},{"type":"raw","value":"<code class=\"language-text\">frontend</code>"},{"type":"text","value":" options to "},{"type":"raw","value":"<code class=\"language-text\">new Engine()</code>"},{"type":"text","value":" no longer exist. "},{"type":"raw","value":"<code class=\"language-text\">new Engine({origin: {requestTimeout: &#39;60s&#39;}})</code>"},{"type":"text","value":" was a shorthand for "},{"type":"raw","value":"<code class=\"language-text\">new Engine({engineConfig: {origins: [{requestTimeout: &#39;60s&#39;}]}})</code>"},{"type":"text","value":". Now that there's no nested "},{"type":"raw","value":"<code class=\"language-text\">engineConfig</code>"},{"type":"text","value":", we think it's straightforward enough to just write "},{"type":"raw","value":"<code class=\"language-text\">new ApolloEngine({origins: [{requestTimeout: &#39;60s&#39;}]})</code>"},{"type":"text","value":" and we don't have to document two very similar ways of doing the same thing."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"If you were directly specifying "},{"type":"raw","value":"<code class=\"language-text\">endpoint</code>"},{"type":"text","value":" in the "},{"type":"raw","value":"<code class=\"language-text\">frontend</code>"},{"type":"text","value":" or "},{"type":"raw","value":"<code class=\"language-text\">engineConfig.frontends</code>"},{"type":"text","value":" option to "},{"type":"raw","value":"<code class=\"language-text\">new Engine</code>"},{"type":"text","value":", that previously-deprecated option no longer exists. You can use the "},{"type":"raw","value":"<code class=\"language-text\">endpoints</code>"},{"type":"text","value":" option instead (which takes an array of paths rather than a single path). That said, you can probably specify this as the "},{"type":"raw","value":"<code class=\"language-text\">graphqlPaths</code>"},{"type":"text","value":" option to "},{"type":"raw","value":"<code class=\"language-text\">engine.listen()</code>"},{"type":"text","value":" instead, or just omit it if it said "},{"type":"raw","value":"<code class=\"language-text\">&#39;/graphql&#39;</code>"},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The "},{"type":"raw","value":"<code class=\"language-text\">startupTimeout</code>"},{"type":"text","value":", "},{"type":"raw","value":"<code class=\"language-text\">proxyStdoutStream</code>"},{"type":"text","value":", and "},{"type":"raw","value":"<code class=\"language-text\">proxyStderrStream</code>"},{"type":"text","value":" options to "},{"type":"raw","value":"<code class=\"language-text\">new Engine()</code>"},{"type":"text","value":" are now nested inside the "},{"type":"raw","value":"<code class=\"language-text\">launcherOptions</code>"},{"type":"text","value":" option to "},{"type":"raw","value":"<code class=\"language-text\">engine.listen()</code>"},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The "},{"type":"raw","value":"<code class=\"language-text\">dumpTraffic</code>"},{"type":"text","value":" option to "},{"type":"raw","value":"<code class=\"language-text\">new Engine()</code>"},{"type":"text","value":" no longer exists."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For full details including an API reference, see "},{"type":"element","tagName":"a","properties":{"href":"/references/engine-proxy/#option-2-running-a-standalone-proxy-using-node"},"children":[{"type":"text","value":"the Node setup guide"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"behind-the-scenes"},"children":[{"type":"element","tagName":"a","properties":{"href":"#behind-the-scenes","aria-label":"behind the scenes permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Behind the scenes"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The old API was based on \"double proxying\". If your web server was supposed to serve on port 4000, you would tell Express (or your other web framework) to listen on port 4000. The "},{"type":"raw","value":"<code class=\"language-text\">Engine</code>"},{"type":"text","value":" class would start an instance of the Engine Proxy running on an ephemeral port (say, 4321). You would add a special middleware to your framework which redirects GraphQL requests to "},{"type":"raw","value":"<code class=\"language-text\">127.0.0.1:4321</code>"},{"type":"text","value":". The Engine Proxy would then make GraphQL requests back to your Node server on port 4000.  The middleware used a special header to differentiate between the initial request from an external client and the nearly-identical internal request from Engine. So GraphQL requests are routed "},{"type":"raw","value":"<code class=\"language-text\">client -&gt; Node -&gt; Engine Proxy -&gt; Node</code>"},{"type":"text","value":" and non-GraphQL requests are routed "},{"type":"raw","value":"<code class=\"language-text\">client -&gt; Node</code>"},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This led to several problems. You needed to be careful to insert your middleware into an appropriately early spot in your web framework routing. Logs would show twice as many requests to your GraphQL server as made by external users unless you specifically filtered out the \"outer\" or \"inner\" GraphQL request. There was a slight performance overhead of sending requests back and forth from the Proxy. Middleware for different web frameworks look entirely different."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We did offer a \"single proxy\" mode that avoided some of the above problems, but it was a little clunky to set up as it didn't integrate directly with your web framework."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The new API gets rid of double proxying entirely. When you run "},{"type":"raw","value":"<code class=\"language-text\">engine.listen({port: 4000, expressApp: app})</code>"},{"type":"text","value":", the new "},{"type":"raw","value":"<code class=\"language-text\">ApolloEngine</code>"},{"type":"text","value":" class starts an instance of your app running on an ephemeral port (say, 4321). It then starts the Engine Proxy itself on port 4000, proxying all requests to "},{"type":"raw","value":"<code class=\"language-text\">127.0.0.1:4321</code>"},{"type":"text","value":". All requests are consistently routed "},{"type":"raw","value":"<code class=\"language-text\">client -&gt; Engine Proxy -&gt; Node</code>"},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This resolves all of the problems listed above. Because there's no \"middleware\" involved, the Engine Proxy is always inserted at the right place in the network: in front of your app. You can't accidentally add the middleware too late. Your app only sees one request per client request, or zero if "},{"type":"element","tagName":"a","properties":{"href":"/references/engine-proxy/#caching"},"children":[{"type":"text","value":"Engine caching"}]},{"type":"text","value":" is doing its job! There's only one layer of local proxying rather than two. Finally, because most web frameworks have very simple similar-looking "},{"type":"raw","value":"<code class=\"language-text\">listen</code>"},{"type":"text","value":" functions, adding support for new web frameworks is easy (which is why v1 adds support for Restify and arbitrary "},{"type":"raw","value":"<code class=\"language-text\">http.Server</code>"},{"type":"text","value":"-based frameworks)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This does mean that "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"all"}]},{"type":"text","value":" of the HTTP traffic on your server is now routed through the Engine Proxy, whereas before non-GraphQL traffic avoided that hop. The Engine Proxy uses the industry-standard Go reverse proxy library to transparently proxy non-GraphQL HTTP and Websocket traffic, so you should observe no major difference.  If you do find any problems from running non-GraphQL traffic through the Engine Proxy, please "},{"type":"element","tagName":"a","properties":{"href":"https://engine.warthog.dev/login?overlay=SupportRequestNoAccount"},"children":[{"type":"text","value":"let us know"}]},{"type":"text","value":", or consider running your GraphQL server separately from other servers."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"upgrading-the-docker-container-to-v1-and-a-new-way-to-run-the-proxy"},"children":[{"type":"element","tagName":"a","properties":{"href":"#upgrading-the-docker-container-to-v1-and-a-new-way-to-run-the-proxy","aria-label":"upgrading the docker container to v1 and a new way to run the proxy permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Upgrading the Docker container to v1 and a new way to run the proxy"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"While most pre-v1 Warthog Engine users use the "},{"type":"raw","value":"<code class=\"language-text\">Engine</code>"},{"type":"text","value":" API from the "},{"type":"raw","value":"<code class=\"language-text\">warthog-engine</code>"},{"type":"text","value":" npm module to run Engine against Node origins, we also provide the Engine Proxy in a Docker container. This is primarily intended for use with non-Node GraphQL servers."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The Docker container is mostly unchanged in v1.  Here's what's new:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"We now use the same version numbers for the Docker containers as for the npm module, so the first v1 Docker container has the tag "},{"type":"raw","value":"<code class=\"language-text\">1.0.1</code>"},{"type":"text","value":" rather than "},{"type":"raw","value":"<code class=\"language-text\">2018.02-90-g65206681c</code>"},{"type":"text","value":". (This may mean that in the future, two consecutive Docker versions will be identical if the only changes in that version are to the Node wrapper code.)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"We recognize that running Docker containers is not feasible in all deployment environments. If you are deploying your non-Node GraphQL server to an environment that can still run Node programs, we've added a new class, "},{"type":"raw","value":"<code class=\"language-text\">ApolloEngineLauncher</code>"},{"type":"text","value":", to the "},{"type":"raw","value":"<code class=\"language-text\">warthog-engine</code>"},{"type":"text","value":" npm module. This allows you to write a short Node script to run the Engine Proxy binary with arbitrary configuration without the extra Node web framework integration provided by the "},{"type":"raw","value":"<code class=\"language-text\">ApolloEngine</code>"},{"type":"text","value":" class documented above."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"The deprecated "},{"type":"raw","value":"<code class=\"language-text\">endpoint</code>"},{"type":"text","value":" field is removed from "},{"type":"raw","value":"<code class=\"language-text\">frontends</code>"},{"type":"text","value":" configuration. Put your endpoint (GraphQL URL path) in a list in "},{"type":"raw","value":"<code class=\"language-text\">endpoints</code>"},{"type":"text","value":" instead, or omit it if it's "},{"type":"raw","value":"<code class=\"language-text\">&#39;/graphql&#39;</code>"},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"It is now valid to specify zero frontends. Engine Proxy will default to one with all default values (listening on an ephemeral port)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"If you configure a frontend endpoint as "},{"type":"raw","value":"<code class=\"language-text\">/graphql</code>"},{"type":"text","value":", requests to "},{"type":"raw","value":"<code class=\"language-text\">/graphql/</code>"},{"type":"text","value":" should be served also. (This previously worked if you were using the "},{"type":"raw","value":"<code class=\"language-text\">Engine</code>"},{"type":"text","value":" double proxy mode but not with the Docker container.)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"automatic-cache-store-configuration"},"children":[{"type":"element","tagName":"a","properties":{"href":"#automatic-cache-store-configuration","aria-label":"automatic cache store configuration permalink","class":"anchor"},"children":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]},{"type":"text","value":"Automatic cache store configuration"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Prior to Engine v1, the features that require an in-memory or memcached cache store ("},{"type":"element","tagName":"a","properties":{"href":"/references/engine-proxy/#caching"},"children":[{"type":"text","value":"public and private full-query response cache"}]},{"type":"text","value":", "},{"type":"element","tagName":"a","properties":{"href":"https://www.warthog.dev/docs/warthog-server/features/apq"},"children":[{"type":"text","value":"automatic persisted queries"}]},{"type":"text","value":", and the session token authorization cache) required you to manually configure a cache store and enable them."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As of Engine v1, these features are on unless specifically disabled, and by default they use a 50MB in-memory cache."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Specifically, the public full-query response cache and automatic persisted query cache are on by default; the private full-query response cache is on if "},{"type":"raw","value":"<code class=\"language-text\">sessionAuth</code>"},{"type":"text","value":" is configured; and the session token authorization cache is on if "},{"type":"raw","value":"<code class=\"language-text\">tokenAuthUrl</code>"},{"type":"text","value":" is configured."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To disable any of these features, just set the corresponding cache name field in the Engine configuration (ie, the argument to "},{"type":"raw","value":"<code class=\"language-text\">new ApolloEngine</code>"},{"type":"text","value":") to "},{"type":"raw","value":"<code class=\"language-text\">&#39;disabled&#39;</code>"},{"type":"text","value":"."}]}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":110,"column":1,"offset":10227}}}}